from pwn import *

# 模仿題目 server.py 中的 step()
def clock(count):
    b = count[0]
    for i in range(63):
        count[i] = count[i+1]
    count[63] = b
    for i in range(len(polylist)):
        count[polylist[i]] ^= b
    return b

# 先拿到前 64 個答案（要解出一開始的 64 個 bits 需要至少 64 個方程式）
stream = []
r = remote('edu-ctf.csie.org', '42069')
money = 1.2
for _ in range(32):
    r.send(b'1\n1\n')
    a = (float(r.recvline().decode(encoding='UTF-8').lstrip('>').strip()))
    if a - money >= 0.019:
        stream.append(1)
    else:
        stream.append(0)
    money = a

    a = (float(r.recvline().decode(encoding='UTF-8').lstrip('>').strip()))
    if a - money >= 0.019:
        stream.append(1)
    else:
        stream.append(0)
    money = a

key_len = 64

poly = [0] * key_len

polylist = [61, 59, 57, 51, 50, 48, 45, 44, 43, 41, 38, 37, 34, 33, 32, 30, 29, 28, 27, 26, 25, 20, 19, 17, 16, 15, 14, 13, 7, 5, 4, 3, 2, 1, 0]

count = [0] * 64

for i in range(64):
    count[i] = 2**i
for i in range(64):
    for _ in range(42):
        clock(count)
    poly[i] = clock(count)

# poly[1] = [3, 4, 5, 6, 8, 9, 10, 11, 12, 13, 15, 17, 18, 20, 24, 25, 26, 32, 35, 41, 42]
# poly[2] = [0, 5, 8, 12, 15, 17, 18, 20, 24, 25, 29, 31, 32, 34, 35, 36, 37, 38, 39, 40, 41, 42, 46, 47, 48, 49, 51, 52, 53, 54, 55, 56, 58, 60, 61, 63]
# poly[3] = [1, 2, 3, 4, 5, 6, 11, 12, 13, 14, 15, 17, 18, 19, 23, 24, 30, 32, 34, 36, 37, 39, 43, 48, 51, 55, 58, 60, 61, 63]
# poly[4] = [1, 4, 5, 6, 7, 9, 10, 17, 18, 19, 25, 26, 27, 28, 29, 33, 34, 37, 40, 41, 42, 44, 45, 46, 47, 48, 49, 54, 55, 56, 57, 58, 60, 61, 62]
# poly[5] = [0, 1, 3, 4, 5, 6, 13, 15, 17, 18, 20, 21, 22, 23, 24, 25, 26, 30, 35, 36, 39, 40, 41, 44, 47, 48, 49, 50, 52, 53, 60, 61, 62]
# poly[6] = [2, 3, 4, 10, 13, 15, 19, 23, 24, 25, 26, 27, 29, 31, 33, 34, 35, 38, 39, 40, 42, 43, 44, 46, 47, 48, 49, 56, 58, 60, 61, 63]
# poly7 = [2, 4, 5, 8, 11, 12, 13, 16, 17, 19, 20, 23, 24, 25, 26, 28, 32, 33, 36, 38, 39, 45, 46, 47, 53, 56, 58, 62]
# poly8 = [1, 5, 6, 8, 10, 11, 12, 14, 15, 18, 19, 21, 22, 23, 26, 29, 30, 31, 32, 33, 34, 39, 42, 45, 47, 48, 51, 54, 55, 56, 59, 60, 62, 63]
# poly9 = [3, 4, 9, 10, 13, 16, 18, 19, 21, 24, 25, 26, 27, 28, 30, 33, 36, 37, 41, 44, 48, 49, 51, 53, 54, 55, 57, 58, 61, 62]
# poly10 = [2, 3, 6, 7, 8, 9, 11, 13, 21, 22, 23, 27, 28, 29, 32, 37, 38, 39, 46, 47, 52, 53, 56, 59, 61, 62]
# poly11 = [0, 1, 2, 3, 4, 6, 9, 12, 13, 16, 18, 19, 20, 22, 24, 25, 26, 28, 33, 34, 36, 37, 38, 45, 46, 49, 50, 51, 52, 54, 56]
# poly12 = [0, 1, 4, 6, 7, 8, 11, 12, 16, 17, 18, 19, 20, 21, 23, 25, 27, 31, 32, 33, 34, 35, 37, 40, 42, 43, 44, 45, 46, 47, 49, 52, 55, 56, 59, 61, 62, 63]
# poly13 = [2, 3, 4, 5, 6, 7, 10, 14, 15, 16, 17, 18, 19, 21, 25, 29, 30, 31, 32, 38, 39, 40, 43, 44, 47, 49, 50, 51, 54, 55, 59, 60, 61, 62, 63]
# poly14 = [1, 2, 3, 7, 9, 13, 14, 16, 17, 19, 20, 21, 23, 25, 26, 27, 28, 29, 30, 31, 36, 37, 38, 41, 45, 46, 47, 48, 49, 50, 53, 57, 58, 59, 60, 61, 62]
# poly15 = [1, 3, 6, 8, 10, 13, 14, 15, 17, 18, 19, 20, 21, 23, 24, 25, 27, 29, 30, 32, 33, 36, 38, 39, 42, 44, 45, 46, 50, 52, 56, 57, 59, 60, 62, 63]
# poly16 = [0, 4, 5, 8, 12, 18, 20, 21, 23, 28, 30, 31, 33, 34, 35, 37, 38, 39, 42, 44, 46, 49, 51, 53, 56, 57, 58, 60, 61, 62, 63]
# poly17 = [0, 3, 4, 5, 6, 7, 8, 11, 18, 20, 23, 26, 27, 29, 31, 33, 34, 37, 38, 42, 43, 47, 48, 51, 55, 61, 63]
# poly18 = [1, 4, 5, 9, 10, 12, 13, 15, 17, 18, 19, 26, 27, 30, 31, 32, 34, 35, 36, 37, 39, 43, 46, 47, 48, 49, 50, 51, 54, 61, 63]
# poly19 = [0, 1, 3, 5, 7, 8, 9, 10, 14, 15, 16, 18, 19, 21, 23, 27, 30, 32, 34, 39, 40, 42, 44, 47, 48, 52, 53, 55, 56, 58, 60, 61, 62]
# poly20 = [0, 1, 3, 4, 5, 10, 11, 13, 15, 16, 17, 18, 19, 20, 21, 22, 26, 28, 30, 31, 33, 34, 35, 36, 38, 43, 44, 46, 48, 50, 51, 52, 53, 57, 58, 59, 61, 62]
# poly21 = [3, 6, 10, 11, 14, 17, 18, 22, 24, 34, 37, 38, 42, 43, 44, 46, 47, 48, 53, 54, 56, 58, 59, 60, 61, 62, 63]
# poly22 = [0, 2, 3, 5, 9, 13, 14, 15, 16, 17, 19, 20, 21, 24, 25, 27, 28, 31, 34, 35, 36, 37, 38, 39, 46, 49, 53, 54, 57, 60, 61]
# poly23 = [1, 3, 4, 5, 6, 8, 9, 11, 13, 15, 19, 20, 30, 31, 32, 33, 35, 38, 39, 40, 42, 43, 45, 46, 48, 52, 56, 57, 58, 59, 60, 62, 63]
# poly24 = [1, 2, 6, 13, 15, 16, 18, 19, 20, 22, 26, 27, 28, 29, 30, 31, 32, 33, 35, 36, 37, 41, 44, 46, 47, 48, 49, 51, 52, 54, 56, 58, 62, 63]
# poly25 = [1, 3, 7, 8, 9, 13, 14, 17, 18, 21, 26, 27, 29, 30, 32, 33, 35, 36, 41, 44, 45, 49, 56, 58, 59, 61, 62, 63]
# poly26 = [0, 6, 8, 9, 10, 12, 15, 17, 19, 21, 22, 24, 25, 26, 28, 29, 32, 33, 36, 38, 39, 44, 46, 50, 51, 52, 56, 57, 60, 61]
# poly27 = [1, 4, 5, 6, 10, 11, 15, 16, 19, 22, 25, 26, 27, 28, 30, 31, 32, 34, 36, 37, 38, 40, 41, 43, 49, 51, 52, 53, 55, 58, 60, 62]
# poly28 = [0, 1, 2, 3, 4, 5, 6, 7, 8, 16, 18, 20, 22, 23, 25, 27, 29, 30, 31, 32, 35, 36, 38, 39, 44, 47, 48, 49, 53, 54, 58, 59, 62]
# poly29 = [2, 6, 7, 9, 12, 13, 14, 17, 19, 20, 23, 24, 29, 31, 33, 34, 36, 37, 40, 41, 43, 44, 45, 46, 47, 48, 49, 50, 51, 59, 61, 63]
# poly30 = [4, 6, 8, 10, 11, 17, 18, 19, 21, 23, 25, 26, 27, 28, 31, 32, 33, 36, 37, 39, 41, 42, 45, 49, 50, 52, 55, 56, 57, 60, 62, 63]
# poly31 = [2, 4, 5, 7, 11, 13, 15, 16, 17, 18, 21, 23, 25, 26, 27, 31, 32, 33, 34, 35, 38, 39, 42, 47, 49, 51, 53, 54, 60, 61, 62]
# poly32 = [1, 3, 5, 6, 9, 12, 14, 15, 17, 18, 19, 22, 28, 30, 31, 32, 34, 36, 37, 38, 40, 42, 45, 47, 48, 50, 54, 56, 58, 59, 60, 61]
# poly33 = [0, 1, 4, 5, 8, 10, 11, 12, 13, 15, 16, 18, 20, 22, 25, 27, 31, 33, 35, 37, 38, 39, 40, 44, 46, 48, 49, 52, 55, 57, 58, 60, 61, 62]
# poly34 = [0, 1, 2, 3, 4, 5, 6, 8, 10, 11, 13, 14, 15, 16, 21, 22, 23, 24, 26, 27, 28, 30, 31, 32, 36, 37, 39, 42, 43, 44, 47, 48, 51, 53, 54, 55, 56, 58, 59, 61, 63]
# poly35 = [0, 3, 8, 9, 10, 12, 17, 18, 19, 20, 21, 24, 26, 27, 28, 30, 31, 35, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 51, 53, 54, 56, 57, 58, 59]
# poly36 = [3, 5, 7, 8, 9, 15, 16, 18, 19, 20, 21, 22, 23, 24, 31, 32, 36, 37, 40, 41, 42, 43, 46, 51, 52, 53, 55, 60, 61, 62, 63]
# poly37 = [3, 5, 7, 8, 10, 16, 17, 18, 20, 22, 23, 24, 26, 29, 30, 32, 35, 38, 41, 46, 48, 50, 51, 52, 58, 59, 61, 62, 63]
# poly38 = [0, 2, 4, 5, 6, 9, 16, 17, 22, 25, 26, 28, 29, 33, 35, 39, 40, 46, 48, 50, 51, 53, 59, 60, 61, 63]
# poly39 = [0, 1, 5, 8, 9, 15, 16, 17, 18, 22, 27, 28, 29, 30, 31, 32, 34, 36, 37, 38, 42, 43, 45, 47, 48, 49, 52, 59, 60]
# poly40 = [0, 2, 6, 7, 10, 11, 12, 13, 14, 18, 22, 23, 24, 25, 26, 27, 31, 32, 33, 37, 38, 39, 41, 43, 44, 48, 51, 52, 58, 59, 60, 61]
# poly41 = [0, 1, 5, 8, 14, 16, 17, 19, 20, 21, 22, 25, 27, 29, 34, 35, 36, 38, 39, 40, 42, 43, 45, 49, 50, 53, 54, 55, 56, 57, 61]
# poly42 = [0, 1, 2, 3, 4, 5, 7, 8, 11, 12, 13, 19, 21, 22, 25, 26, 27, 29, 33, 34, 35, 36, 39, 40, 41, 43, 44, 48, 51, 57, 59, 60, 62, 63]
# poly43 = [1, 2, 3, 4, 5, 9, 11, 12, 13, 15, 18, 19, 20, 22, 23, 24, 25, 27, 28, 32, 33, 38, 39, 42, 43, 44, 45, 46, 47, 48, 50, 51, 54, 55, 56, 62]
# poly44 = [1, 2, 3, 8, 9, 11, 12, 13, 15, 16, 18, 19, 20, 21, 22, 23, 24, 25, 27, 28, 29, 30, 34, 37, 39, 40, 41, 42, 44, 45, 46, 47, 48, 52, 54, 55, 56, 58, 61, 62, 63]
# poly45 = [2, 3, 6, 7, 8, 9, 12, 13, 17, 19, 20, 23, 24, 27, 28, 31, 32, 33, 34, 40, 41, 42, 44, 45, 46, 51, 52, 54, 55, 56, 58, 59, 61, 62, 63]
# poly46 = [0, 1, 2, 3, 4, 5, 6, 10, 12, 15, 17, 18, 19, 23, 26, 31, 32, 34, 35, 36, 37, 38, 39, 40, 41, 42, 45, 46, 49, 50, 51, 52, 55, 56, 60, 62, 63]
# poly47 = [0, 1, 2, 3, 4, 7, 10, 11, 12, 13, 16, 19, 21, 22, 23, 24, 26, 32, 33, 35, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 53, 55, 58, 60, 61, 62]
# poly48 = [0, 1, 2, 4, 5, 7, 8, 12, 13, 14, 15, 17, 18, 20, 21, 24, 26, 27, 30, 31, 34, 35, 37, 38, 43, 44, 45, 46, 47, 50, 53, 54, 55, 56, 59, 62]
# poly49 = [1, 2, 4, 6, 12, 13, 15, 16, 17, 20, 21, 22, 23, 24, 27, 28, 29, 33, 37, 38, 43, 44, 45, 47, 48, 50, 51, 55, 56, 57, 58, 60, 61, 63]
# poly50 = [1, 4, 6, 9, 10, 13, 14, 15, 19, 20, 22, 23, 26, 28, 29, 31, 32, 35, 36, 42, 44, 45, 47, 49, 55, 56, 58, 59, 60, 63]
# poly51 = [1, 2, 5, 6, 8, 9, 10, 13, 14, 16, 17, 20, 21, 23, 24, 25, 29, 33, 34, 38, 40, 41, 42, 44, 47, 49, 52, 53, 56, 57, 58, 62, 63]
# poly52 = [0, 4, 5, 7, 11, 12, 13, 15, 21, 22, 25, 26, 29, 31, 32, 35, 37, 38, 40, 41, 42, 44, 45, 48, 49, 51, 52, 53, 56, 57, 59, 60, 63]
# poly53 = [0, 1, 2, 3, 5, 6, 9, 10, 14, 15, 21, 24, 25, 26, 27, 29, 32, 36, 37, 41, 43, 47, 48, 50, 54, 55, 56, 58]
# poly54 = [0, 4, 5, 7, 8, 9, 10, 14, 15, 17, 19, 20, 23, 27, 28, 30, 31, 34, 35, 38, 39, 40, 41, 42, 43, 44, 45, 46, 48, 49, 52, 53, 57, 58]
# poly55 = [1, 3, 5, 6, 7, 8, 11, 15, 16, 18, 23, 25, 26, 30, 32, 34, 36, 37, 38, 39, 40, 43, 47, 48, 50, 51, 52, 53, 57, 58, 60, 62, 63]
# poly56 = [1, 2, 3, 6, 7, 8, 10, 11, 13, 16, 18, 23, 24, 27, 28, 30, 32, 33, 35, 37, 41, 42, 44, 46, 48, 49, 50, 51, 54, 58, 59, 61]
# poly57 = [1, 4, 6, 7, 8, 10, 12, 16, 17, 18, 19, 21, 26, 27, 28, 29, 32, 34, 35, 36, 37, 41, 42, 44, 45, 46, 49, 50, 51, 53, 54, 56, 59, 61]
# poly58 = [0, 5, 9, 11, 13, 14, 17, 20, 30, 31, 33, 35, 38, 40, 41, 44, 47, 49, 50, 51, 53, 55, 59, 60, 61, 62]
# poly59 = [0, 2, 3, 8, 10, 11, 12, 13, 16, 17, 18, 19, 22, 23, 24, 26, 27, 29, 30, 31, 32, 34, 35, 37, 39, 41, 42, 43, 48, 52, 54, 56, 57, 60, 63]
# poly60 = [0, 2, 5, 6, 10, 14, 15, 16, 20, 21, 25, 26, 27, 28, 29, 31, 37, 40, 42, 43, 45, 46, 51, 53, 54, 55, 56, 59, 60, 61, 62]
# poly61 = [0, 7, 8, 9, 12, 13, 16, 18, 19, 21, 23, 25, 26, 28, 32, 33, 35, 36, 38, 40, 41, 43, 45, 48, 49, 53, 57, 58, 59, 63]
# poly62 = [0, 1, 2, 4, 6, 9, 10, 12, 13, 16, 17, 18, 22, 23, 25, 26, 27, 30, 33, 35, 36, 39, 40, 43, 50, 51, 52, 55, 56, 59, 61, 62]
# poly63 = [0, 1, 2, 5, 6, 11, 12, 14, 16, 17, 18, 20, 21, 22, 25, 26, 27, 28, 29, 31, 34, 35, 37, 38, 39, 42, 43, 44, 45, 47, 49, 52, 53, 55, 56, 59, 60, 61]
# poly64 = [1, 2, 3, 4, 6, 7, 12, 14, 18, 20, 24, 25, 26, 27, 29, 32, 33, 34, 36, 37, 38, 41, 42, 43, 44, 45, 48, 49, 54, 55, 57, 59, 60, 61, 63]

key = [0] * key_len
s = []

# 透過 64 個 poly 解出 64 個 key (一開始的 bits)
tempt = [0] * 64
tempt_stream = [0] * 64
sign = 0
sign_stream = 0
for i in range(64):
    tempt[i] = poly[i]
    tempt_stream[i] = stream[i]
for i in range(63):
    k = 0
    for j in range(64-i):
        if tempt[j] % 2**(i+1) != 0:
            if k == 0:
                sign = tempt[j]
                sign_stream = tempt_stream[j]
                k = 1
            else:
                tempt[j-1] = sign ^ tempt[j]
                tempt_stream[j-1] = sign_stream ^ tempt_stream[j]
        elif k == 1:
            tempt[j-1] = tempt[j]
            tempt_stream[j-1] = tempt_stream[j]
        else:
            tempt[j] = tempt[j]
            tempt_stream[j] = tempt_stream[j]
print('63 ' + bin(tempt[0]))
key[63] = tempt_stream[0]

for a in range(63):
    sign = 0
    sign_stream = 0
    for i in range(64):
        tempt[i] = poly[i]
        tempt_stream[i] = stream[i]
    for i in range(63-a):
        k = 0
        for j in range(64-i):
            if tempt[j] % 2**(i+1) != 0:
                if k == 0:
                    sign = tempt[j]
                    sign_stream = tempt_stream[j]
                    k = 1
                else:
                    tempt[j-1] = sign ^ tempt[j]
                    tempt_stream[j-1] = sign_stream ^ tempt_stream[j]
            elif k == 1:
                tempt[j-1] = tempt[j]
                tempt_stream[j-1] = tempt_stream[j]
            else:
                tempt[j] = tempt[j]
                tempt_stream[j] = tempt_stream[j]
    for i in range(a+1):
        if sign & 2**(63-i) != 0:
            sign ^= 2**(63-i)
            sign_stream ^= key[63-i]
    print(str(62 - a) + ' ' + bin(sign))
    key[62 - a] = sign_stream


for _ in range(64):
    for _ in range(42):
        clock(key)
    s.append(clock(key))

str1 = ''
for i in range(64):
    if s[i] != stream[i]:
        print(str(i) + ' ' + bin(poly[i]))
while(money <= 2.4):
    result = 0
    for _ in range(42):
        clock(key)
    str1 = str1 + str(clock(key)) + '\n'
    money += 0.02
r.send(str1)
while(1):
    print(r.recvline())